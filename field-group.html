<script>
  window.addEventListener('DOMContentLoaded', function () {

    // ファイルが選択されたら実行
    document.getElementById("uploadFile").addEventListener('change', function (e) {
      //ファイルを選択したときのファイル情報のオブジェクト
      let fileReader = new FileReader();

      // ファイルの読み込みを行ったら実行
      fileReader.addEventListener('load', function (e) {
        const csvDatas = []; // 最終的な二次元配列を入れるための配列
        const tmps = e.target.result.split(/\r\n|\n/); // 改行を区切り文字として行を要素とした配列を生成
        const noEmptyTmps = tmps.filter(function (s) { // 空要素削除
          return s !== '';
        });

        // 各行ごとにカンマで区切った文字列を要素とした二次元配列を生成
        const CategoryNames = noEmptyTmps[0].split(',');
        console.log(CategoryNames);
        //カンマごとに要素を区切って配列に格納
        noEmptyTmps.forEach((rowOfData, varse) => {
          csvDatas[varse] = rowOfData.split(',');
        })
        //カテゴリー名の要素を削除
        csvDatas.splice(0, 1);
        console.log(csvDatas);
        //csvデータのオブジェクト生成
        const csvInfos = [];
        csvDatas.forEach((data, number) => {
          let csvGroup = {};
          CategoryNames.forEach((key, index) => {
            csvGroup[key] = csvDatas[number][index];
          })
          csvInfos.push(csvGroup);
          console.log(csvInfos)
        })
        csvInfos.forEach((csvElement,csvIndex) => {
          const contentArea = Array.from(document.getElementsByClassName("item-template"));
          //複製
          const cloneElement = contentArea[csvIndex].cloneNode(true);
          // 複製した要素の属性を編集
          cloneElement.class = "";
          //複製した要素の子孫要素編集
          const inputElement = cloneElement.querySelectorAll("input");
          console.log(inputElement);
          for (let i = 0)
          // inputElement.forEach((input,form) => {
          //   input.type = "text";
          //   //ここ微妙
          //   if (form !== inputElement.length - 1) {
          //     input.name = csvElement.CategoryNames[form];
          //   }else{
          //     ;
          //   }
          // })
           contentArea[csvIndex].after(cloneElement);
        });
      });
      //指定されたファイルの内容を読み取り、完了後csvDatasプロパティにファイルの内容を文字列として格納
      fileReader.readAsText(e.target.files[0]);
    });
  });
</script>

<h2 class="acms-admin-admin-title2">カスタムフィールドグループ サンプル</h2>
<table class="js-fieldgroup-sortable adminTable acms-admin-table-admin-edit">
  <thead class="acms-admin-hide-sp">
    <tr>
      <th class="acms-admin-table-left acms-admin-admin-config-table-item-handle"> </th>
      <th class="acms-admin-table-left">XXX(画像)</th>
      <th class="acms-admin-table-left">YYY(日付)</th>
      <th class="acms-admin-table-left">ZZZ(タイトル)</th>
      <th class="acms-admin-table-left acms-admin-admin-config-table-action">削除</th>
    </tr>
  </thead>
  <tbody>
    <!-- BEGIN sample:loop -->
    <tr class="sortable-item">
      <td class="item-handle acms-admin-table-nowrap">
        <i class="acms-admin-icon-sort"></i>
      </td>
      <td>
        <input type="text" name="xxx[]" value="{xxx}" class="acms-admin-form-width-full" />
      </td>
      <td>
        <input type="text" name="yyy[]" value="{yyy}" class="acms-admin-form-width-full" />
      </td>
      <td>
        <input type="text" name="zzz[]" value="{zzz}" class="acms-admin-form-width-full" />
      </td>
      <td class="acms-admin-table-nowrap">
        <input type="button" class="item-delete acms-admin-btn-admin acms-admin-btn-admin-danger" value="削除" />
      </td>
    </tr>
    <!-- END sample:loop -->
    <tr class="sortable-item item-template">
      <td class="item-handle acms-admin-table-nowrap">
        <i class="acms-admin-icon-sort"></i>
      </td>
      <td>
        <input type="text" name="xxx[]" value="" class="acms-admin-form-width-full" />
      </td>
      <td>
        <input type="text" name="yyy[]" value="" class="acms-admin-form-width-full" />
      </td>
      <td>
        <input type="text" name="zzz[]" value="" class="acms-admin-form-width-full" />
      </td>
      <td class="acms-admin-table-nowrap">
        <input type="button" class="item-delete acms-admin-btn-admin acms-admin-btn-admin-danger" value="削除" />
      </td>
    </tr>

    <div class="container">
      <div id="table" class="userTableBox">
      </div>

  </tbody>
  <tfoot>
    <tr>
      <td colSpan="5">
        <input type="button" class="item-insert acms-admin-btn-admin" value="追加" />
      </td>
    </tr>
  </tfoot>
</table>
<input type="hidden" name="@sample[]" value="xxx" />
<input type="hidden" name="field[]" value="xxx" />
<input type="hidden" name="@sample[]" value="yyy" />
<input type="hidden" name="field[]" value="yyy" />
<input type="hidden" name="@sample[]" value="zzz" />
<input type="hidden" name="field[]" value="zzz" />
<input type="hidden" name="field[]" value="@sample" />

<input type="file" class="item-insert" id="uploadFile">
